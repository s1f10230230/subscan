# クレジットカード管理アプリ要件定義書

## 1. プロジェクト概要

### 1.1 アプリ名
**CardSync**（仮称）

### 1.2 目的・解決する課題
- 複数クレジットカードの管理を一元化
- メール通知からの自動データ取得による手入力の削減
- 使用していないサブスクリプションの検出・可視化
- 既存家計簿アプリの手動入力の煩わしさを解決

### 1.3 ターゲットユーザー
- 複数のクレジットカードを所有している人
- 複数のサブスクリプションサービスを利用している人
- 家計管理を効率化したい人

## 2. 機能要件

### 2.1 認証機能
- **ソーシャルログイン対応**
  - Google アカウント
  - 必要に応じて他のプロバイダー追加
- **アカウント管理**
  - プロフィール設定
  - 料金プラン管理

### 2.2 メール連携機能
- **対応メールプロバイダー**（Phase 1）
  - Gmail API連携
  - Yahoo Mail API連携
- **メール解析機能**
  - クレジットカード利用通知メールの自動検出
  - 支払い情報の抽出（金額、日付、店舗名）
  - 誤認識データの手動修正機能

### 2.3 クレジットカード管理
- **対応カード会社**（利用率順に実装）
  - 楽天カード
  - 三井住友カード
  - JCBカード
  - イオンカード
  - その他主要カード会社
- **データ取得期間**
  - 無料版：なし（手動入力のみ）
  - 有料版：デフォルト3ヶ月、Pro版1年
- **複数カード統合表示**
  - カード別支出集計
  - 全カード統合ビュー

### 2.4 家計簿機能
- **支出管理**
  - 自動分類（メール解析ベース）
  - 手動カテゴリ修正機能
  - カスタムカテゴリ作成
- **カテゴリ分類**
  - 食費、交通費、エンタメ、サブスクリプション
  - 生活費、医療費、その他
- **期間設定**
  - 月の開始日：ユーザー設定可能（デフォルト1日）
  - 週次・月次・年次集計

### 2.5 サブスクリプション検出機能
- **段階的検出戦略**
  - **Phase 1: 確実検出（90%以上の精度）**
    - Netflix, Spotify, Amazon Prime, YouTube Premium
    - Adobe Creative Cloud, Microsoft 365
    - 楽天市場, Amazon (定期便)
    - docomo, au, SoftBank
  - **Phase 2: パターン学習拡張**
    - ユーザー修正データからの学習
    - 新サービスパターンの段階的追加
- **検出ロジック**
  - 差出人メールアドレス + 件名パターン + 金額の組み合わせ
  - 引き落とし日±3日の誤差で同額の定期支払い
  - 外貨建てサブスク対応（為替レート考慮）
- **結果表示の工夫**
  - 「確実なサブスク」と「可能性のあるもの」を分けて表示
  - 検出できなかったものの手動追加を促進
  - 「他のメールアドレスでも確認しませんか？」提案
- **学習機能**
  - ユーザーの修正・追加データで精度向上
  - 新しいサービスパターンの自動学習

### 2.6 データ表示・分析機能
- **ダッシュボード**
  - 月間支出総額
  - カテゴリ別支出グラフ
  - サブスクリプション一覧
  - 支出トレンド分析
- **レポート機能**
  - 月次・年次レポート
  - カード別使用状況
  - サブスクリプションコスト分析

## 3. 技術要件

### 3.1 技術スタック
- **フロントエンド**
  - Next.js 14（App Router）
  - React 18
  - TypeScript
  - Tailwind CSS
  - Recharts（グラフ表示）

- **バックエンド**
  - Next.js API Routes
  - Prisma（ORM）
  - PostgreSQL（データベース）

- **認証**
  - NextAuth.js（Auth.js v5）

- **外部API**
  - Gmail API
  - Yahoo Mail API
  - Stripe（決済処理）

- **インフラ**
  - Vercel（ホスティング）
  - Vercel PostgreSQL（データベース）

### 3.2 パフォーマンス要件
- **メール処理**
  - バックグラウンド処理での大量メール解析
  - 段階的データ取得（ページネーション）
  - キャッシュ機能による高速表示
- **応答時間**
  - ページ読み込み：3秒以内
  - API応答：1秒以内

### 3.3 セキュリティ要件
- **データ保護**
  - メールデータの暗号化保存
  - 金融データの安全な取り扱い
  - HTTPS通信の強制
- **API セキュリティ**
  - レート制限の実装
  - 認証トークンの適切な管理
- **プライバシー**
  - GDPR準拠
  - データ削除機能

## 4. ビジネス要件

### 4.1 料金プラン
- **無料版**
  - 手動家計簿入力
  - 手動サブスクリプション登録
  - 広告表示
- **有料版（月額/年額）**
  - メール自動連携
  - 複数クレジットカード管理
  - サブスクリプション自動検出
  - 3ヶ月間のデータ保持
- **Pro版（月額/年額）**
  - 1年間のデータ保持
  - 高度な分析機能
  - 優先サポート

### 4.2 決済機能
- Stripe統合
- 月額・年額プランの自動課金
- プラン変更・キャンセル機能

## 5. 非機能要件

### 5.1 対応環境
- **Webブラウザ**
  - Chrome, Firefox, Safari, Edge（最新版）
- **モバイル対応**
  - レスポンシブデザイン
  - PWA対応（将来的にネイティブアプリ化検討）

### 5.2 可用性
- 稼働率：99%以上
- 定期メンテナンス時間を除く

### 5.3 拡張性
- ユーザー数増加に対応可能な設計
- 新しいカード会社・メールプロバイダーの追加容易性

## 6. 開発計画

### 6.1 開発体制
- 個人開発（1名）
- 開発・運用・サポートすべて担当

### 6.2 リスク管理
- **技術的リスク**
  - メール解析精度の課題 → 機械学習・正規表現の組み合わせ
  - 大量データ処理のタイムアウト → バックグラウンド処理・キュー実装
- **法的リスク**
  - 金融データ取り扱いの法規制確認
  - プライバシーポリシーの適切な策定

### 6.3 成功指標
- ユーザー登録数
- 有料プラン転換率
- ユーザー継続率
- サブスクリプション検出精度

## 7. 画面設計要件

### 7.1 認証・マーケティング画面
1. **ランディングページ**
   - ヒーローセクション（メインメッセージ・CTA）
   - 課題提起（手動入力の煩わしさ、サブスク忘れ）
   - 解決策提示（自動取得・一元管理・サブスク検知）
   - 機能紹介（スクリーンショット付き）
   - 料金プラン比較表
   - ユーザーの声・導入効果
   - FAQ セクション
   - フッター（会社概要・プライバシーポリシー）

2. **ログイン/サインアップページ**
   - ソーシャルログインボタン（Google優先表示）
   - 「無料で始める」を強調
   - サービス特徴の簡潔な説明
   - 利用規約・プライバシーポリシーへの同意

3. **オンボーディング画面**（初回ログイン時）
   - **ステップ1：価値提案**
     「過去3ヶ月のメールから、隠れた支出とサブスクを分析してみませんか？（3分で完了）」
   - **ステップ2：簡単Gmail連携**
     - 「Gmailで始める」ボタン（最もハードル低く）
     - セキュリティ説明（「メール内容は読まず、件名と差出人のみ取得」）
     - 取得データ範囲の明示（「過去3ヶ月のクレカ通知メールのみ」）
   - **ステップ3：分析実行**
     - プログレスバー表示「メールを分析中...」
     - 「◯件のクレカ利用を発見」「◯個のサブスクを検出」
   - **ステップ4：結果表示 = WOW体験**
     - 「◯個の確実なサブスクを発見しました」
     - 月額・年額コストの可視化「月額◯円 × ◯個 = 年間◯万円」
     - 「可能性のあるもの」セクション（控えめに表示）
     - クレカ利用状況の月次グラフ表示
     - 「解約すれば年◯万円の節約が可能」（確実なもののみで計算）
     - 期待値コントロール「他にも隠れたサブスクがあるかもしれません」
   - **ステップ5：プラン提案（自然な流れ）**
     - 「より詳しい分析と継続監視には有料プランがおすすめ」
     - 「今なら初月無料」オファー
     - 「無料版でも基本機能はご利用可能です」

4. **料金プラン詳細ページ**
   - 3つのプラン比較（無料・スタンダード・プロ）
   - 機能詳細説明
   - よくある質問
   - 返金ポリシー
   - 決済フォーム

### 7.2 アプリケーション画面
5. **ダッシュボード** - 支出総額・グラフ表示
6. **家計簿画面** - 取引履歴・カテゴリ管理
7. **サブスク管理画面** - 検出されたサブスク一覧
8. **設定画面** - メール連携・プロフィール設定・プラン変更

### 7.3 サポート画面
9. **ヘルプ・サポートページ**
   - よくある質問
   - 使い方ガイド
   - お問い合わせフォーム
10. **利用規約・プライバシーポリシー**

### 7.2 UI/UX要件
- シンプルで直感的なデザイン
- モバイルファースト設計
- アクセシビリティ対応
- ダークモード対応

## 8. データ設計要件

### 8.1 主要エンティティ
- **User** - ユーザー情報
- **CreditCard** - クレジットカード情報
- **Transaction** - 取引データ
- **Category** - カテゴリ
- **Subscription** - サブスクリプション
- **EmailData** - メールデータ（暗号化）

### 8.2 データ保持期間
- 無料版：手動入力データのみ永続保存
- 有料版：3ヶ月間のメールデータ
- Pro版：1年間のメールデータ
- 退会時：30日後に全データ削除

---

